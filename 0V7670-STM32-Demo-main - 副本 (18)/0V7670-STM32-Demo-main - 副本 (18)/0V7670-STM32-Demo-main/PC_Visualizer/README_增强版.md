# OV7670 Camera Viewer - å¢å¼ºç‰ˆ

## ğŸš€ ä¸»è¦æ”¹è¿›

### 1. CRC32 æ•°æ®å®Œæ•´æ€§æ ¡éªŒ âœ…
- **STM32ç«¯**: ä½¿ç”¨ç¡¬ä»¶CRC32è®¡ç®—æ•´ä¸ªå›¾åƒæ•°æ®
- **PCç«¯**: éªŒè¯CRC32ï¼Œä¸¢å¼ƒæŸåçš„æ•°æ®å¸§
- **åè®®æ ¼å¼**: `IMG_START,320,240,16,1\r\n` (æœ«å°¾çš„1è¡¨ç¤ºCRCä½¿èƒ½)

### 2. Floyd-Steinberg Dithering ç®—æ³• âœ…
- **é—®é¢˜**: RGB565 (5-6-5ä½) è½¬ RGB888 æ—¶äº§ç”Ÿé¢œè‰²é˜¶æ¢¯æ•ˆåº”
- **è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨è¯¯å·®æ‰©æ•£ç®—æ³•ï¼Œå°†é‡åŒ–è¯¯å·®åˆ†æ•£åˆ°é‚»è¿‘åƒç´ 
- **æ•ˆæœ**: æ˜¾è‘—å‡å°‘é¢œè‰²æ¡å¸¦ï¼Œæå‡è§†è§‰è´¨é‡

**é¢œè‰²ç²¾åº¦å¯¹æ¯”**:
```
åŸå§‹RGB565: R(32çº§) G(64çº§) B(32çº§)
è½¬æ¢RGB888: R(256çº§) G(256çº§) B(256çº§)
é‡åŒ–å:     R(32çº§) G(64çº§) B(32çº§) + Dithering
```

### 3. æ™ºèƒ½ç¼“å†²åŒºç®¡ç† âœ…
- **çŠ¶æ€æœº**: WAIT_HEADER â†’ WAIT_DATA â†’ [WAIT_CRC] â†’ WAIT_END
- **æ»‘åŠ¨çª—å£**: è‡ªåŠ¨æ¸…ç†æ— æ•ˆæ•°æ®ï¼Œé˜²æ­¢ç¼“å†²åŒºæº¢å‡º
- **æ•°æ®å®Œæ•´æ€§æ£€æŸ¥**: é•¿åº¦éªŒè¯ + CRCéªŒè¯

**ç¼“å†²åŒºç®¡ç†ç­–ç•¥**:
```python
# å¸§å¤´æŸ¥æ‰¾
if len(buffer) > 1000:
    buffer = buffer[-100:]  # ä¿ç•™æœ€å100å­—èŠ‚

# æ•°æ®æå–
if len(buffer) >= expected_data_size:
    image_data = buffer[:expected_data_size]
    buffer = buffer[expected_data_size:]
```

## ğŸ“‹ åè®®å¯¹æ¯”

### åŸå§‹åè®®
```
IMG_START,320,240,16\r\n
[153600å­—èŠ‚å›¾åƒæ•°æ®]
\r\nIMAGE_END\r\n
```

### å¢å¼ºåè®®
```
IMG_START,320,240,16,1\r\n
[153600å­—èŠ‚å›¾åƒæ•°æ®]
[4å­—èŠ‚CRC32]
\r\nIMAGE_END\r\n
```

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### CRC32 è®¡ç®— (STM32)
```c
// ç¡¬ä»¶CRCè®¡ç®—
CRC_ResetDR();
for(i = 0; i < 240; i++) {
    for(j = 0; j < 160; j++) {
        uint32_t word_data = ...;  // 4å­—èŠ‚ç»„åˆ
        crc_value = CRC_CalcCRC(word_data);
    }
}
// å‘é€4å­—èŠ‚CRCå€¼
```

### Dithering ç®—æ³• (Python)
```python
def floyd_steinberg_dithering(rgb888):
    for y in range(height):
        for x in range(width):
            # é‡åŒ–åˆ°RGB565ç²¾åº¦
            new_pixel = round(old_pixel / 8) * 8  # Rå’ŒB
            new_pixel = round(old_pixel / 4) * 4  # G

            # è®¡ç®—è¯¯å·®å¹¶æ‰©æ•£
            error = old_pixel - new_pixel
            result[y, x+1] += error * (7/16)
            result[y+1, x-1] += error * (3/16)
            result[y+1, x]   += error * (5/16)
            result[y+1, x+1] += error * (1/16)
```

### æ™ºèƒ½æ»¤æ³¢
```python
# æ£€æµ‹å¹¶ä¿®å¤é›¶å€¼æ•°æ®
zero_indices = np.where(rgb565 == 0)[0]
if len(zero_indices) > 100:
    for idx in zero_indices:
        if idx > 0 and idx < len(rgb565) - 1:
            # ä½¿ç”¨å‰ååƒç´ å¹³å‡å€¼
            rgb565[idx] = (rgb565[idx-1] + rgb565[idx+1]) // 2
```

## ğŸ® ä½¿ç”¨è¯´æ˜

### è¿è¡Œç¨‹åº
```bash
cd PC_Visualizer
python camera_viewer_fixed_display.py
```

### äº¤äº’æŒ‰é”®
- **ESC**: é€€å‡ºç¨‹åº
- **S**: æ‰‹åŠ¨ä¿å­˜å½“å‰ç¼“å†²åŒº
- **D**: åˆ‡æ¢Ditheringæ¨¡å¼ï¼ˆå¯ç”¨/ç¦ç”¨ï¼‰

### æ˜¾ç¤ºä¿¡æ¯
```
âœ“ æ”¶åˆ°å¸§å¤´: IMG_START,320,240,16,1
  å°ºå¯¸: 320x240, ä½æ·±: 16, CRC: å¯ç”¨
âœ“ å›¾åƒæ•°æ®æ¥æ”¶å®Œæˆ: 153600 å­—èŠ‚
âœ“ æ”¶åˆ°CRC32: 0x12345678
  CRCæ ¡éªŒé€šè¿‡
âœ“ æ”¶åˆ°å¸§ç»“æŸæ ‡è®°
  åº”ç”¨Ditheringç®—æ³•ä¼˜åŒ–é¢œè‰²...
  âœ“ å·²ä¿å­˜: captures/frame_20260101_120000_1.jpg
  ğŸ“Š æ€»å¸§æ•°: 1 | Dithering: å¯ç”¨
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| åŠŸèƒ½ | åŸç‰ˆ | å¢å¼ºç‰ˆ |
|------|------|--------|
| æ•°æ®å®Œæ•´æ€§ | âŒ æ— æ ¡éªŒ | âœ… CRC32æ ¡éªŒ |
| é¢œè‰²è´¨é‡ | âš ï¸ æœ‰é˜¶æ¢¯ | âœ… Ditheringä¼˜åŒ– |
| ç¼“å†²åŒºç®¡ç† | âš ï¸ ç®€å•æˆªå– | âœ… æ™ºèƒ½çŠ¶æ€æœº |
| é”™è¯¯æ¢å¤ | âŒ æ—  | âœ… è‡ªåŠ¨ä¸¢å¼ƒåå¸§ |
| äº¤äº’æ€§ | âš ï¸ åŸºç¡€ | âœ… æ¨¡å¼åˆ‡æ¢ |

## ğŸ” æ•…éšœæ’é™¤

### CRCæ ¡éªŒå¤±è´¥
- **åŸå› **: ä¸²å£å¹²æ‰°æˆ–æ—¶åºé—®é¢˜
- **è§£å†³**: ç¨‹åºè‡ªåŠ¨ä¸¢å¼ƒåå¸§ï¼Œç»§ç»­æ¥æ”¶ä¸‹ä¸€å¸§

### å›¾åƒèŠ±å±
- **åŸå› **: æ•°æ®ä¸¢å¤±æˆ–é”™ä½
- **è§£å†³**: çŠ¶æ€æœºè‡ªåŠ¨æ¢å¤ï¼Œæ£€æŸ¥æ¥çº¿

### Ditheringæ€§èƒ½
- **è¯´æ˜**: é¦–æ¬¡å¤„ç†è¾ƒæ…¢ï¼Œåç»­å¸§ä¼šç¼“å­˜
- **ä¼˜åŒ–**: å¯æŒ‰Dé”®ç¦ç”¨ä»¥æé«˜é€Ÿåº¦

## ğŸ“ æ–‡ä»¶ç»“æ„

```
PC_Visualizer/
â”œâ”€â”€ camera_viewer_fixed_display.py  # ä¸»ç¨‹åºï¼ˆå¢å¼ºç‰ˆï¼‰
â”œâ”€â”€ config.py                        # é…ç½®æ–‡ä»¶
â”œâ”€â”€ README_å¢å¼ºç‰ˆ.md                # æœ¬è¯´æ˜æ–‡æ¡£
â””â”€â”€ captures/                        # ä¿å­˜çš„å›¾åƒ
```

## âœ… æµ‹è¯•å»ºè®®

1. **åŠŸèƒ½æµ‹è¯•**: è¿è¡Œç¨‹åºï¼Œè§‚å¯ŸCRCæ ¡éªŒè¾“å‡º
2. **è´¨é‡å¯¹æ¯”**: æŒ‰Dé”®åˆ‡æ¢Ditheringï¼Œè§‚å¯Ÿé¢œè‰²å·®å¼‚
3. **ç¨³å®šæ€§æµ‹è¯•**: é•¿æ—¶é—´è¿è¡Œï¼Œæ£€æŸ¥é”™è¯¯æ¢å¤
4. **æ•°æ®å®Œæ•´æ€§**: æ•…æ„å¹²æ‰°æ•°æ®ï¼ŒéªŒè¯CRCæ£€æµ‹

---

**ç‰ˆæœ¬**: å¢å¼ºç‰ˆ v2.0
**æ›´æ–°æ—¥æœŸ**: 2026-01-01
**ä¸»è¦æ”¹è¿›**: CRCæ ¡éªŒ + Dithering + æ™ºèƒ½ç¼“å†²
